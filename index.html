<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<title>Test 4 - Verify a Linkchain Anchored Comunica Query</title>

	<link href="./app.css" rel='stylesheet' type='text/css'>

	<script type="text/javascript" src="./lib/linkchains-bundle.js"></script>
	<script type="application/javascript" src="https://rdf.js.org/comunica-browser/versions/v2/engines/query-sparql/comunica-browser.js"></script>
	<script type="application/javascript" src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
	<script type="text/javascript" src="./contract.js"></script>
	<script type="text/javascript" src="./app.js"></script>
</head>

<body onload="initApp();">

	<div class="title_head">
		<span class="headlogo"><a href="https://kmi.open.ac.uk/" title="Knowledge Media Institute at Open University"><img alt="Knowledge Media Institute at Open University" src="./images/kmi-logo.png" /></a></span>
		<span class="headlogoright"><a href="https://open.ac.uk/" title="Open University"><img alt="Open University" src="./images/ou-logo.png" /></a></span>
	</div>

	<div class="holder">
		<h2>Verify a Linkchain Anchored Comunica Query</h2>

		<div class="innerholder" style="padding-top:10px;">

			<div class="panel" style="clear:both; float: left;margin-top:20px;">
				<span>
					<h3>Connect to MetaMask (Select a testnet)</h3>

					<span class="infobig">Note: Requires a configured Metamask wallet - see </span><a href="https://github.com/KMiOpenBlockchain/isws2022-demonstrator/blob/main/README.md#metamask-and-the-rinkby-ethereum-testnet">here</a>
					<br /><br />
					<button class="buttonmetamask" name="enableEthereumButton" id="enableEthereumButton" disabled="false" onclick="loginToMetaMask()">Connect to MetaMask</button>
					<label for="ethereumaccount">Ethereum Account: </label>
					<label id="ethereumaccount"></label>
					</br />
				</span>
			</div>

			<div class="panel" style="clear:both; float: left;margin-top:20px;">
				<span>
					<h3>Verify an Anchored Query</h3>

					Either load from Stored Data below, choose the files to use, or paste the data into the boxes.
					<br /><br />
					<label for="RDFInputFile">Choose a file of JSON RDF Query data:</label>   <input type="file" id="RDFInputFile" name="RDFInputFile">
					<button class="button" id="readRDFInputFileButton" name="readRDFInputFileButton">Read File</button>
					<br /><br />
					<label for="queryRDFInputArea">SPARQL Trace Data:</label>
					<br />
					<span class="info">(JSON-LD object containing query, sources, results and query plans)</span>
					<br />
					<textarea name="queryRDFInputArea" id="queryRDFInputArea" class="textareastyle"></textarea>

					<br /><br />
					<label for="anchoredMetadataFile">Choose a file of anchored MerQL metadata:</label>   <input type="file" id="anchoredMetadataFile" name="anchoredMetadataFile">
					<button class="button" id="readAnchoredMetadataButton" name="readAnchoredMetadataButton">Read File</button>

					<br /><br />
					<label for="anchoredMetadataInputArea">Granular Anchored Metadata</label>
					<br />
					<textarea name="anchoredMetadataInputArea" id="anchoredMetadataInputArea" class="textareastyle"></textarea>

					<br /><br />
					<button class="buttonmetamask" id="verifyButton" onclick="verifyQuery()">Verify</button>
					<br /><br />

					<label>Verification Results</label>
					<br />
					<textarea id="verifyResults" class="textareastyle"></textarea>
					<span class="infobig">Verification results contain two arrays, 'verified' and 'unverified', in N-Quads/N-Triples format, for quads/triples which passed or failed verification, respectively.</span>
					<br />

				</span>
			</div>
			<div class="panel" style="clear:both; float: left;margin-top:20px;">
				<span>
					<h3>Stored Data</h3>

					<table style="width: 100%">
						<thead style="background-color: lightgray">
							<tr>
								<th width="10">Date</th>
								<th width="10">Sources</th>
								<th width="15">Query</th>
								<th width="15">Query Result</th>
								<th width="15">SPARQL Trace Data</th>
								<th width="15">Anchored MerQL Metadata</th>
								<th width="10">Granular Anchored MerQL Metadata</th>
								<th width="10">Verify</th>
							</tr>
						</thead>
						<tbody id="storedDataTable" style="background-color: white;"></tbody>
					</table>
				</span>
			</div>

			<br /><br />
		</div>
	</div>

	<div class="popup" id="popupDiv">
		<textarea class="popuptext" id="popupText"></textarea>
		<button class="button popupbutton" onclick="closePopup()">Close</button>
		<button class="button popupbutton" onclick="copyToClipboard()">Copy</button>
	</div>

	<div class="clearit"></div>
	<br>
	<div class="bottomband"><a href="http://kmi.open.ac.uk">Copyright The Knowledge Media Institute</a></div>
</body>

</html>
